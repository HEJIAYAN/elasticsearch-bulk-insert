<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ElasticSearchBulkMeta.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PDI Elasticsearch Bulk Insert Plugin Core</a> &gt; <a href="index.source.html" class="el_package">org.pentaho.di.trans.steps.elasticsearchbulk</a> &gt; <span class="el_source">ElasticSearchBulkMeta.java</span></div><h1>ElasticSearchBulkMeta.java</h1><pre class="source lang-java linenums">/*! ******************************************************************************
 *
 * Pentaho Data Integration
 *
 * Copyright (C) 2002-2017 by Hitachi Vantara : http://www.pentaho.com
 *
 *******************************************************************************
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 ******************************************************************************/

package org.pentaho.di.trans.steps.elasticsearchbulk;

import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.UnknownHostException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;
import java.util.concurrent.TimeUnit;

import org.apache.commons.lang.StringUtils;
import org.pentaho.di.core.CheckResult;
import org.pentaho.di.core.CheckResultInterface;
import org.pentaho.di.core.Const;
import org.pentaho.di.core.annotations.Step;
import org.pentaho.di.core.database.DatabaseMeta;
import org.pentaho.di.core.exception.KettleException;
import org.pentaho.di.core.exception.KettleStepException;
import org.pentaho.di.core.exception.KettleXMLException;
import org.pentaho.di.core.injection.Injection;
import org.pentaho.di.core.injection.InjectionDeep;
import org.pentaho.di.core.injection.InjectionSupported;
import org.pentaho.di.core.row.RowMetaInterface;
import org.pentaho.di.core.row.ValueMeta;
import org.pentaho.di.core.row.ValueMetaInterface;
import org.pentaho.di.core.variables.VariableSpace;
import org.pentaho.di.core.xml.XMLHandler;
import org.pentaho.di.i18n.BaseMessages;
import org.pentaho.di.repository.ObjectId;
import org.pentaho.di.repository.Repository;
import org.pentaho.di.trans.Trans;
import org.pentaho.di.trans.TransMeta;
import org.pentaho.di.trans.step.BaseStepMeta;
import org.pentaho.di.trans.step.StepDataInterface;
import org.pentaho.di.trans.step.StepInterface;
import org.pentaho.di.trans.step.StepMeta;
import org.pentaho.di.trans.step.StepMetaInterface;
import org.pentaho.metastore.api.IMetaStore;
import org.w3c.dom.Node;

@Step( id = &quot;ElasticSearchBulk&quot;, i18nPackageName = &quot;org.pentaho.di.trans.steps.elasticsearch&quot;,
    name = &quot;ElasticSearchBulk.TypeLongDesc.ElasticSearchBulk&quot;,
    description = &quot;ElasticSearchBulk.TypeTooltipDesc.ElasticSearchBulk&quot;,
    categoryDescription = &quot;i18n:org.pentaho.di.trans.step:BaseStep.Category.Bulk&quot;, image = &quot;ESB.svg&quot;,
    documentationUrl = &quot;Products/Data_Integration/Transformation_Step_Reference/ElasticSearch_Bulk_Insert&quot; )
@InjectionSupported( localizationPrefix = &quot;ElasticSearchBulk.Injection.&quot; )
public class ElasticSearchBulkMeta extends BaseStepMeta implements StepMetaInterface {

<span class="fc" id="L73">  private static Class&lt;?&gt; PKG = ElasticSearchBulkMeta.class; // for i18n purposes</span>

  /**
   * Serialization aids
   */
<span class="nc" id="L78">  private static class Dom {</span>
    static final String TAG_GENERAL = &quot;general&quot;;

    static final String TAG_INDEX = &quot;index&quot;;
    static final String TAG_TYPE = &quot;type&quot;;
    static final String TAG_IS_JSON = &quot;isJson&quot;;
    static final String TAG_JSON_FIELD = &quot;jsonField&quot;;

    static final String TAG_ID_IN_FIELD = &quot;idField&quot;;
    static final String TAG_OVERWRITE_IF_EXISTS = &quot;overwriteIfExists&quot;;

    static final String TAG_ID_OUT_FIELD = &quot;idOutputField&quot;;
    static final String TAG_USE_OUTPUT = &quot;useOutput&quot;;
    static final String TAG_STOP_ON_ERROR = &quot;stopOnError&quot;;
    static final String TAG_TIMEOUT = &quot;timeout&quot;;
    static final String TAG_TIMEOUT_UNIT = &quot;timeoutUnit&quot;;
    static final String TAG_BATCH_SIZE = &quot;batchSize&quot;;

    static final String TAG_FIELDS = &quot;fields&quot;;
    static final String TAG_FIELD = &quot;field&quot;;

    static final String TAG_NAME = &quot;columnName&quot;;
    static final String TAG_TARGET = &quot;targetName&quot;;

    static final String TAG_SERVERS = &quot;servers&quot;;
    static final String TAG_SERVER = &quot;server&quot;;
    static final String TAG_SERVER_ADDRESS = &quot;address&quot;;
    static final String TAG_SERVER_PORT = &quot;port&quot;;

    public static final String TAG_SETTINGS = &quot;settings&quot;;
    public static final String TAG_SETTING = &quot;setting&quot;;
    public static final String TAG_SETTING_NAME = &quot;name&quot;;
    public static final String TAG_SETTING_VALUE = &quot;value&quot;;

    static final String INDENT = &quot;  &quot;;
  }

  public static final int DEFAULT_BATCH_SIZE = 50000;
<span class="fc" id="L116">  public static final Long DEFAULT_TIMEOUT = 10L;</span>
<span class="fc" id="L117">  public static final TimeUnit DEFAULT_TIMEOUT_UNIT = TimeUnit.SECONDS;</span>
  public static final int DEFAULT_PORT = 9300;

  // ///////////
  // FIELDS //
  // /////////

<span class="fc" id="L124">  @Injection( name = &quot;INDEX_NAME&quot; )</span>
  private String index = null;
<span class="fc" id="L126">  @Injection( name = &quot;INDEX_TYPE&quot; )</span>
  private String type = null;
<span class="fc" id="L128">  @Injection( name = &quot;JSON_INPUT&quot; )</span>
  private boolean isJsonInsert = false;
<span class="fc" id="L130">  @Injection( name = &quot;JSON_FIELD&quot; )</span>
  private String jsonField = null;

<span class="fc" id="L133">  @Injection( name = &quot;ID_FIELD&quot; )</span>
  private String idInField = null;
<span class="fc" id="L135">  @Injection( name = &quot;OVERWRITE_IF_EXIST&quot; )</span>
  private boolean overWriteIfSameId = false;
<span class="fc" id="L137">  @Injection( name = &quot;ID_OUTPUT_FIELD&quot; )</span>
  private String idOutField = null;
<span class="fc" id="L139">  @Injection( name = &quot;USE_OUTPUT&quot; )</span>
  private boolean useOutput = false;
<span class="fc" id="L141">  @Injection( name = &quot;STOP_ON_ERROR&quot; )</span>
  private boolean stopOnError = true;

  @Injection( name = &quot;BATCH_SIZE&quot; )
  private String batchSize;
  @Injection( name = &quot;TIMEOUT_VALUE&quot; )
  private String timeout;
  @Injection( name = &quot;TIMEOUT_UNIT&quot; )
  private TimeUnit timeoutUnit;

<span class="fc" id="L151">  @InjectionDeep( prefix = &quot;SERVER&quot; )</span>
  List&lt;Server&gt; servers = new ArrayList&lt;&gt;();
<span class="fc" id="L153">  @InjectionDeep( prefix = &quot;FIELD&quot; )</span>
  List&lt;Field&gt; fields = new ArrayList&lt;&gt;();
<span class="fc" id="L155">  @InjectionDeep( prefix = &quot;SETTING&quot; )</span>
  List&lt;Setting&gt; settings = new ArrayList&lt;&gt;();
  // private List&lt;InetSocketTransportAddress&gt; servers = new ArrayList&lt;InetSocketTransportAddress&gt;();

  /** fields to use in json generation */
  //private Map&lt;String, String&gt; fields = new HashMap&lt;String, String&gt;();
  //private Map&lt;String, String&gt; settings = new HashMap&lt;String, String&gt;();

  // ////////////////////
  // GETTERS/SETTERS //
  // //////////////////
  public String getJsonField() {
<span class="fc" id="L167">    return jsonField;</span>
  }

  public void setJsonField( String jsonField ) {
<span class="pc bpc" id="L171" title="1 of 2 branches missed.">    this.jsonField = StringUtils.isBlank( jsonField ) ? null : jsonField;</span>
<span class="fc" id="L172">  }</span>

  public String getIdOutField() {
<span class="fc" id="L175">    return idOutField;</span>
  }

  public void setIdOutField( String idField ) {
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">    this.idOutField = StringUtils.isBlank( idField ) ? null : idField;</span>
<span class="fc" id="L180">  }</span>

  public boolean isJsonInsert() {
<span class="fc" id="L183">    return isJsonInsert;</span>
  }

  public void setJsonInsert( boolean isJsonInsert ) {
<span class="fc" id="L187">    this.isJsonInsert = isJsonInsert;</span>
<span class="fc" id="L188">  }</span>

  public String getIndex() {
<span class="fc" id="L191">    return index;</span>
  }

  public void setIndex( String index ) {
<span class="fc" id="L195">    this.index = index;</span>
<span class="fc" id="L196">  }</span>

  public String getType() {
<span class="fc" id="L199">    return type;</span>
  }

  public void setType( String type ) {
<span class="fc" id="L203">    this.type = type;</span>
<span class="fc" id="L204">  }</span>

  public void setIdInField( String idInField ) {
<span class="fc" id="L207">    this.idInField = idInField;</span>
<span class="fc" id="L208">  }</span>

  public String getIdInField() {
<span class="fc" id="L211">    return idInField;</span>
  }

  public void setOverWriteIfSameId( boolean overWriteIfSameId ) {
<span class="fc" id="L215">    this.overWriteIfSameId = overWriteIfSameId;</span>
<span class="fc" id="L216">  }</span>

  public boolean isOverWriteIfSameId() {
<span class="fc" id="L219">    return overWriteIfSameId;</span>
  }

  public boolean isUseOutput() {
<span class="fc" id="L223">    return useOutput;</span>
  }

  public void setUseOutput( boolean value ) {
<span class="fc" id="L227">    useOutput = value;</span>
<span class="fc" id="L228">  }</span>

  public boolean isStopOnError() {
<span class="fc" id="L231">    return stopOnError;</span>
  }

  public void setStopOnError( boolean stopOnError ) {
<span class="fc" id="L235">    this.stopOnError = stopOnError;</span>
<span class="fc" id="L236">  }</span>

  public List&lt;Field&gt; getFields() {
<span class="nc" id="L239">    return Collections.unmodifiableList( fields );</span>
  }

  public Map&lt;String, String&gt; getFieldsMap() {
<span class="fc" id="L243">    Map&lt;String, String&gt; result = new TreeMap&lt;&gt;();</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">    for ( Field f : fields ) {</span>
<span class="fc" id="L245">      result.put( f.name, f.targetName );</span>
<span class="fc" id="L246">    }</span>
<span class="fc" id="L247">    return Collections.unmodifiableMap( result );</span>
  }

  public void setFieldsMap( Map&lt;String, String&gt; values ) {
<span class="fc" id="L251">    clearFields();</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">    for ( String k : values.keySet() ) {</span>
<span class="fc" id="L253">      addField( k, values.get( k ) );</span>
<span class="fc" id="L254">    }</span>
<span class="fc" id="L255">  }</span>

  public void clearFields() {
<span class="fc" id="L258">    this.fields.clear();</span>
<span class="fc" id="L259">  }</span>

  public void addField( String inputName, String nameInJson ) {
<span class="fc" id="L262">    Field f = new Field();</span>
<span class="fc" id="L263">    f.name = inputName;</span>
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">    f.targetName = StringUtils.isBlank( nameInJson ) ? inputName : nameInJson;</span>
<span class="fc" id="L265">    this.fields.add( f );</span>
<span class="fc" id="L266">  }</span>

  public List&lt;Server&gt; getServers() {
<span class="fc" id="L269">    return Collections.unmodifiableList( servers );</span>
  }

  public void setServers( List&lt;Server&gt; values ) {
<span class="fc" id="L273">    servers.clear();</span>
<span class="fc" id="L274">    servers.addAll( values );</span>
<span class="fc" id="L275">  }</span>

  public void clearServers() {
<span class="fc" id="L278">    servers.clear();</span>
<span class="fc" id="L279">  }</span>

  public void addServer( String addr, int port ) {
<span class="fc" id="L282">    Server s = new Server();</span>
<span class="fc" id="L283">    s.address = addr;</span>
<span class="fc" id="L284">    s.port = port;</span>
<span class="fc" id="L285">    servers.add( s );</span>
<span class="fc" id="L286">  }</span>

  public Map&lt;String, String&gt; getSettingsMap() {
<span class="fc" id="L289">    Map&lt;String, String&gt; result = new TreeMap&lt;&gt;();</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">    for ( Setting s : settings ) {</span>
<span class="fc" id="L291">      result.put( s.setting, s.value );</span>
<span class="fc" id="L292">    }</span>
<span class="fc" id="L293">    return Collections.unmodifiableMap( result );</span>
  }

  public void setSettingsMap( Map&lt;String, String&gt; values ) {
<span class="fc" id="L297">    clearSettings();</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">    for ( String k : values.keySet() ) {</span>
<span class="fc" id="L299">      addSetting( k, values.get( k ) );</span>
<span class="fc" id="L300">    }</span>
<span class="fc" id="L301">  }</span>

  public void clearSettings() {
<span class="fc" id="L304">    settings.clear();</span>
<span class="fc" id="L305">  }</span>

  public void addSetting( String property, String value ) {
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">    if ( StringUtils.isNotBlank( property ) ) {</span>
<span class="fc" id="L309">      Setting s = new Setting();</span>
<span class="fc" id="L310">      s.setting = property;</span>
<span class="fc" id="L311">      s.value = value;</span>
<span class="fc" id="L312">      settings.add( s );</span>
    }
<span class="fc" id="L314">  }</span>

  /**
   * @param value
   *          The batch size to set
   */
  public void setBatchSize( String value ) {
<span class="fc" id="L321">    this.batchSize = value;</span>
<span class="fc" id="L322">  }</span>

  /**
   * @return Returns the batchSize.
   */
  public String getBatchSize() {
<span class="fc" id="L328">    return this.batchSize;</span>
  }

  public int getBatchSizeInt( VariableSpace vars ) {
<span class="fc" id="L332">    return Const.toInt( vars.environmentSubstitute( this.batchSize ), DEFAULT_BATCH_SIZE );</span>
  }

  /**
   * @return Returns the TimeOut.
   */
  public String getTimeOut() {
<span class="fc" id="L339">    return timeout;</span>
  }

  /**
   * @param TimeOut
   *          The TimeOut to set.
   */
  public void setTimeOut( String TimeOut ) {
<span class="fc" id="L347">    this.timeout = TimeOut;</span>
<span class="fc" id="L348">  }</span>

  public TimeUnit getTimeoutUnit() {
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">    return timeoutUnit != null ? timeoutUnit : DEFAULT_TIMEOUT_UNIT;</span>
  }

  public void setTimeoutUnit( TimeUnit timeoutUnit ) {
<span class="fc" id="L355">    this.timeoutUnit = timeoutUnit;</span>
<span class="fc" id="L356">  }</span>

  // ////////////////
  // CONSTRUCTOR //
  // //////////////

  public ElasticSearchBulkMeta() {
<span class="fc" id="L363">    super(); // allocate BaseStepMeta</span>
<span class="fc" id="L364">  }</span>

  public Object clone() {
<span class="fc" id="L367">    ElasticSearchBulkMeta retval = (ElasticSearchBulkMeta) super.clone();</span>

<span class="fc" id="L369">    return retval;</span>
  }

  public void setDefault() {
<span class="fc" id="L373">    batchSize = &quot;&quot; + DEFAULT_BATCH_SIZE;</span>
<span class="fc" id="L374">    timeoutUnit = DEFAULT_TIMEOUT_UNIT;</span>
<span class="fc" id="L375">    index = &quot;twitter&quot;;</span>
<span class="fc" id="L376">    type = &quot;tweet&quot;;</span>

<span class="fc" id="L378">    isJsonInsert = false;</span>
<span class="fc" id="L379">    jsonField = null;</span>
<span class="fc" id="L380">    idOutField = null;</span>
<span class="fc" id="L381">    useOutput = false;</span>
<span class="fc" id="L382">    stopOnError = true;</span>
<span class="fc" id="L383">  }</span>

  /* This function adds meta data to the rows being pushed out */
  public void getFields( RowMetaInterface r, String name, RowMetaInterface[] info, StepMeta nextStep,
      VariableSpace space, Repository repository, IMetaStore metaStore ) throws KettleStepException {
<span class="nc bnc" id="L388" title="All 2 branches missed.">    if ( StringUtils.isNotBlank( this.getIdOutField() ) ) {</span>
<span class="nc" id="L389">      ValueMetaInterface valueMeta =</span>
<span class="nc" id="L390">          new ValueMeta( space.environmentSubstitute( this.getIdOutField() ), ValueMetaInterface.TYPE_STRING );</span>
<span class="nc" id="L391">      valueMeta.setOrigin( name );</span>
      // add if doesn't exist
<span class="nc bnc" id="L393" title="All 2 branches missed.">      if ( !r.exists( valueMeta ) ) {</span>
<span class="nc" id="L394">        r.addValueMeta( valueMeta );</span>
      }
    }
<span class="nc" id="L397">  }</span>

  public void loadXML( Node stepnode, List&lt;DatabaseMeta&gt; databases, IMetaStore metaStore ) throws KettleXMLException {
    try {

<span class="fc" id="L402">      Node general = XMLHandler.getSubNode( stepnode, Dom.TAG_GENERAL );</span>

<span class="fc" id="L404">      batchSize = XMLHandler.getTagValue( general, Dom.TAG_BATCH_SIZE );</span>
<span class="fc" id="L405">      timeout = XMLHandler.getTagValue( general, Dom.TAG_TIMEOUT );</span>
<span class="fc" id="L406">      String timeoutStr = XMLHandler.getTagValue( general, Dom.TAG_TIMEOUT_UNIT );</span>
      try {
<span class="fc" id="L408">        timeoutUnit = TimeUnit.valueOf( timeoutStr );</span>
<span class="nc" id="L409">      } catch ( Exception e ) {</span>
<span class="nc" id="L410">        timeoutUnit = DEFAULT_TIMEOUT_UNIT;</span>
<span class="fc" id="L411">      }</span>

<span class="fc" id="L413">      setIndex( XMLHandler.getTagValue( general, Dom.TAG_INDEX ) );</span>
<span class="fc" id="L414">      setType( XMLHandler.getTagValue( general, Dom.TAG_TYPE ) );</span>

<span class="fc" id="L416">      setJsonInsert( parseBool( XMLHandler.getTagValue( general, Dom.TAG_IS_JSON ) ) );</span>
<span class="fc" id="L417">      setJsonField( XMLHandler.getTagValue( general, Dom.TAG_JSON_FIELD ) );</span>
<span class="fc" id="L418">      setIdInField( XMLHandler.getTagValue( general, Dom.TAG_ID_IN_FIELD ) );</span>
<span class="fc" id="L419">      setOverWriteIfSameId( parseBool( XMLHandler.getTagValue( general, Dom.TAG_OVERWRITE_IF_EXISTS ) ) );</span>

<span class="fc" id="L421">      setIdOutField( XMLHandler.getTagValue( general, Dom.TAG_ID_OUT_FIELD ) );</span>
<span class="fc" id="L422">      setUseOutput( parseBool( XMLHandler.getTagValue( general, Dom.TAG_USE_OUTPUT ) ) );</span>
<span class="fc" id="L423">      setStopOnError( parseBool( XMLHandler.getTagValue( general, Dom.TAG_STOP_ON_ERROR ) ) );</span>

      // Fields
<span class="fc" id="L426">      Node fields = XMLHandler.getSubNode( stepnode, Dom.TAG_FIELDS );</span>
<span class="fc" id="L427">      int nrFields = XMLHandler.countNodes( fields, Dom.TAG_FIELD );</span>
<span class="fc" id="L428">      this.clearFields();</span>
<span class="fc bfc" id="L429" title="All 2 branches covered.">      for ( int i = 0; i &lt; nrFields; i++ ) {</span>
<span class="fc" id="L430">        Node fNode = XMLHandler.getSubNodeByNr( fields, Dom.TAG_FIELD, i );</span>

<span class="fc" id="L432">        String colName = XMLHandler.getTagValue( fNode, Dom.TAG_NAME );</span>
<span class="fc" id="L433">        String targetName = XMLHandler.getTagValue( fNode, Dom.TAG_TARGET );</span>

<span class="fc" id="L435">        this.addField( colName, targetName );</span>
      }

      // Servers
<span class="fc" id="L439">      Node servers = XMLHandler.getSubNode( stepnode, Dom.TAG_SERVERS );</span>
<span class="fc" id="L440">      int nrServers = XMLHandler.countNodes( servers, Dom.TAG_SERVER );</span>
<span class="fc" id="L441">      this.clearServers();</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">      for ( int i = 0; i &lt; nrServers; i++ ) {</span>
<span class="fc" id="L443">        Node sNode = XMLHandler.getSubNodeByNr( servers, Dom.TAG_SERVER, i );</span>

<span class="fc" id="L445">        String addr = XMLHandler.getTagValue( sNode, Dom.TAG_SERVER_ADDRESS );</span>
<span class="fc" id="L446">        String portStr = XMLHandler.getTagValue( sNode, Dom.TAG_SERVER_PORT );</span>

<span class="fc" id="L448">        int port = DEFAULT_PORT;</span>
        try {
<span class="fc" id="L450">          port = Integer.parseInt( portStr );</span>
<span class="nc" id="L451">        } catch ( NumberFormatException nfe ) {</span>
          // use default
<span class="fc" id="L453">        }</span>
<span class="fc" id="L454">        this.addServer( addr, port );</span>
      }

      // Settings
<span class="fc" id="L458">      Node settings = XMLHandler.getSubNode( stepnode, Dom.TAG_SETTINGS );</span>
<span class="fc" id="L459">      int nrSettings = XMLHandler.countNodes( settings, Dom.TAG_SETTING );</span>
<span class="fc" id="L460">      this.clearSettings();</span>
<span class="fc bfc" id="L461" title="All 2 branches covered.">      for ( int i = 0; i &lt; nrSettings; i++ ) {</span>
<span class="fc" id="L462">        Node sNode = XMLHandler.getSubNodeByNr( settings, Dom.TAG_SETTING, i );</span>

<span class="fc" id="L464">        String name = XMLHandler.getTagValue( sNode, Dom.TAG_SETTING_NAME );</span>
<span class="fc" id="L465">        String value = XMLHandler.getTagValue( sNode, Dom.TAG_SETTING_VALUE );</span>

<span class="fc" id="L467">        this.addSetting( name, value );</span>
      }

<span class="nc" id="L470">    } catch ( Exception e ) {</span>
<span class="nc" id="L471">      throw new KettleXMLException( &quot;Unable to load step info from XML&quot;, e );</span>
<span class="fc" id="L472">    }</span>
<span class="fc" id="L473">  }</span>

  private static boolean parseBool( String val ) {
<span class="fc" id="L476">    return &quot;Y&quot;.equals( val );</span>
  }

  public String getXML() {
<span class="fc" id="L480">    StringBuffer retval = new StringBuffer();</span>
<span class="fc" id="L481">    Indentation indent = new Indentation();</span>

<span class="fc" id="L483">    indent.incr().incr();</span>

    // General
<span class="fc" id="L486">    retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_GENERAL ) ).append( Const.CR );</span>
<span class="fc" id="L487">    indent.incr();</span>

<span class="fc" id="L489">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_INDEX, getIndex() ) );</span>
<span class="fc" id="L490">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_TYPE, getType() ) );</span>

<span class="fc" id="L492">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_BATCH_SIZE, batchSize ) );</span>
<span class="fc" id="L493">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_TIMEOUT, timeout ) );</span>
<span class="fc" id="L494">    retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_TIMEOUT_UNIT, timeoutUnit.toString() ) );</span>

<span class="fc" id="L496">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_IS_JSON, isJsonInsert() ) );</span>
<span class="pc bpc" id="L497" title="1 of 2 branches missed.">    if ( getJsonField() != null ) {</span>
<span class="fc" id="L498">      retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_JSON_FIELD, getJsonField() ) );</span>
    }
<span class="pc bpc" id="L500" title="1 of 2 branches missed.">    if ( getIdOutField() != null ) {</span>
<span class="fc" id="L501">      retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_ID_OUT_FIELD, getIdOutField() ) );</span>
    }

<span class="pc bpc" id="L504" title="1 of 2 branches missed.">    if ( getIdInField() != null ) {</span>
<span class="fc" id="L505">      retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_ID_IN_FIELD, getIdInField() ) );</span>
    }

<span class="fc" id="L508">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_OVERWRITE_IF_EXISTS, isOverWriteIfSameId() ) );</span>

<span class="fc" id="L510">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_USE_OUTPUT, useOutput ) );</span>
<span class="fc" id="L511">    retval.append( indent.toString() + XMLHandler.addTagValue( Dom.TAG_STOP_ON_ERROR, stopOnError ) );</span>

<span class="fc" id="L513">    indent.decr();</span>
<span class="fc" id="L514">    retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_GENERAL ) ).append( Const.CR );</span>

    // Fields
<span class="fc" id="L517">    retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_FIELDS ) ).append( Const.CR );</span>
<span class="fc" id="L518">    indent.incr();</span>
<span class="fc bfc" id="L519" title="All 2 branches covered.">    for ( Field f : fields ) {</span>
<span class="fc" id="L520">      retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_FIELD ) ).append( Const.CR );</span>
<span class="fc" id="L521">      indent.incr();</span>
<span class="fc" id="L522">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_NAME, f.name ) );</span>
<span class="fc" id="L523">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_TARGET, f.targetName ) );</span>
<span class="fc" id="L524">      indent.decr();</span>
<span class="fc" id="L525">      retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_FIELD ) ).append( Const.CR );</span>
<span class="fc" id="L526">    }</span>
<span class="fc" id="L527">    indent.decr();</span>
<span class="fc" id="L528">    retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_FIELDS ) ).append( Const.CR );</span>

    // Servers
<span class="fc" id="L531">    retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_SERVERS ) ).append( Const.CR );</span>
<span class="fc" id="L532">    indent.incr();</span>
<span class="fc bfc" id="L533" title="All 2 branches covered.">    for ( Server istAddr : servers ) {</span>
<span class="fc" id="L534">      retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_SERVER ) ).append( Const.CR );</span>
<span class="fc" id="L535">      indent.incr();</span>
<span class="fc" id="L536">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_SERVER_ADDRESS, istAddr.address ) );</span>
<span class="fc" id="L537">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_SERVER_PORT, istAddr.port ) );</span>
<span class="fc" id="L538">      indent.decr();</span>
<span class="fc" id="L539">      retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_SERVER ) ).append( Const.CR );</span>
<span class="fc" id="L540">    }</span>
<span class="fc" id="L541">    indent.decr();</span>
<span class="fc" id="L542">    retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_SERVERS ) ).append( Const.CR );</span>

    // Settings
<span class="fc" id="L545">    retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_SETTINGS ) ).append( Const.CR );</span>
<span class="fc" id="L546">    indent.incr();</span>
<span class="fc bfc" id="L547" title="All 2 branches covered.">    for ( Setting s : settings ) {</span>
<span class="fc" id="L548">      retval.append( indent.toString() ).append( XMLHandler.openTag( Dom.TAG_SETTING ) ).append( Const.CR );</span>
<span class="fc" id="L549">      indent.incr();</span>
<span class="fc" id="L550">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_SETTING_NAME, s.setting ) );</span>
<span class="fc" id="L551">      retval.append( indent.toString() ).append( XMLHandler.addTagValue( Dom.TAG_SETTING_VALUE, s.value ) );</span>
<span class="fc" id="L552">      indent.decr();</span>
<span class="fc" id="L553">      retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_SETTING ) ).append( Const.CR );</span>
<span class="fc" id="L554">    }</span>
<span class="fc" id="L555">    indent.decr();</span>
<span class="fc" id="L556">    retval.append( indent.toString() ).append( XMLHandler.closeTag( Dom.TAG_SETTINGS ) ).append( Const.CR );</span>

<span class="fc" id="L558">    return retval.toString();</span>
  }

<span class="fc" id="L561">  private static class Indentation {</span>

<span class="fc" id="L563">    private static String indentUnit = Dom.INDENT;</span>
<span class="fc" id="L564">    private String indent = &quot;&quot;;</span>
<span class="fc" id="L565">    private int indentLevel = 0;</span>

    public Indentation incr() {
<span class="fc" id="L568">      indentLevel++;</span>
<span class="fc" id="L569">      indent += indentUnit;</span>
<span class="fc" id="L570">      return this;</span>
    }

    public Indentation decr() {
<span class="pc bpc" id="L574" title="1 of 2 branches missed.">      if ( --indentLevel &gt;= 0 ) {</span>
<span class="fc" id="L575">        indent = indent.substring( 0, indent.length() - indentUnit.length() );</span>
      }
<span class="fc" id="L577">      return this;</span>
    }

    public String toString() {
<span class="fc" id="L581">      return indent;</span>
    }

  }

  private static String joinRepAttr( String... args ) {
<span class="fc" id="L587">    return StringUtils.join( args, &quot;_&quot; );</span>
  }

  public void readRep( Repository rep, IMetaStore metaStore, ObjectId id_step, List&lt;DatabaseMeta&gt; databases )
    throws KettleException {
    try {

<span class="fc" id="L594">      setIndex( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_INDEX ) ) );</span>
<span class="fc" id="L595">      setType( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TYPE ) ) );</span>

<span class="fc" id="L597">      setBatchSize( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_BATCH_SIZE ) ) );</span>
<span class="fc" id="L598">      setTimeOut( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TIMEOUT ) ) );</span>
<span class="fc" id="L599">      String timeoutStr = rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TIMEOUT_UNIT ) );</span>
      try {
<span class="fc" id="L601">        timeoutUnit = TimeUnit.valueOf( timeoutStr );</span>
<span class="nc" id="L602">      } catch ( Exception e ) {</span>
<span class="nc" id="L603">        timeoutUnit = DEFAULT_TIMEOUT_UNIT;</span>
<span class="fc" id="L604">      }</span>

<span class="fc" id="L606">      setJsonInsert( rep.getStepAttributeBoolean( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_IS_JSON ) ) );</span>
<span class="fc" id="L607">      setJsonField( ( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_JSON_FIELD ) ) ) );</span>

<span class="fc" id="L609">      setIdInField( ( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_ID_IN_FIELD ) ) ) );</span>
<span class="fc" id="L610">      setOverWriteIfSameId( rep.getStepAttributeBoolean( id_step, joinRepAttr( Dom.TAG_GENERAL,</span>
          Dom.TAG_OVERWRITE_IF_EXISTS ) ) );

<span class="fc" id="L613">      setIdOutField( ( rep.getStepAttributeString( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_ID_OUT_FIELD ) ) ) );</span>

<span class="fc" id="L615">      setUseOutput( rep.getStepAttributeBoolean( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_USE_OUTPUT ) ) );</span>
<span class="fc" id="L616">      setStopOnError( rep.getStepAttributeBoolean( id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_STOP_ON_ERROR ) ) );</span>

      // Fields
<span class="fc" id="L619">      clearFields();</span>
<span class="fc" id="L620">      int fieldsNr = rep.countNrStepAttributes( id_step, joinRepAttr( Dom.TAG_FIELD, Dom.TAG_NAME ) );</span>
<span class="fc bfc" id="L621" title="All 2 branches covered.">      for ( int i = 0; i &lt; fieldsNr; i++ ) {</span>
<span class="fc" id="L622">        String name = rep.getStepAttributeString( id_step, i, joinRepAttr( Dom.TAG_FIELD, Dom.TAG_NAME ) );</span>
<span class="fc" id="L623">        String target = rep.getStepAttributeString( id_step, i, joinRepAttr( Dom.TAG_FIELD, Dom.TAG_TARGET ) );</span>
<span class="fc" id="L624">        addField( name, target );</span>
      }

      // Servers
<span class="fc" id="L628">      clearServers();</span>
<span class="fc" id="L629">      int serversNr = rep.countNrStepAttributes( id_step, joinRepAttr( Dom.TAG_SERVER, Dom.TAG_SERVER_ADDRESS ) );</span>
<span class="fc bfc" id="L630" title="All 2 branches covered.">      for ( int i = 0; i &lt; serversNr; i++ ) {</span>
<span class="fc" id="L631">        String addr = rep.getStepAttributeString( id_step, i, joinRepAttr( Dom.TAG_SERVER, Dom.TAG_SERVER_ADDRESS ) );</span>
<span class="fc" id="L632">        int port = (int) rep.getStepAttributeInteger( id_step, i, joinRepAttr( Dom.TAG_SERVER, Dom.TAG_SERVER_PORT ) );</span>
<span class="fc" id="L633">        addServer( addr, port );</span>
      }

      // Settings
<span class="fc" id="L637">      clearSettings();</span>
<span class="fc" id="L638">      int settingsNr = rep.countNrStepAttributes( id_step, joinRepAttr( Dom.TAG_SETTING, Dom.TAG_SETTING_NAME ) );</span>
<span class="fc bfc" id="L639" title="All 2 branches covered.">      for ( int i = 0; i &lt; settingsNr; i++ ) {</span>
<span class="fc" id="L640">        String name = rep.getStepAttributeString( id_step, i, joinRepAttr( Dom.TAG_SETTING, Dom.TAG_SETTING_NAME ) );</span>
<span class="fc" id="L641">        String value = rep.getStepAttributeString( id_step, i, joinRepAttr( Dom.TAG_SETTING, Dom.TAG_SETTING_VALUE ) );</span>
<span class="fc" id="L642">        addSetting( name, value );</span>
      }

<span class="nc" id="L645">    } catch ( Exception e ) {</span>
<span class="nc" id="L646">      throw new KettleException(</span>
<span class="nc" id="L647">          BaseMessages.getString( PKG, &quot;ElasticSearchBulkMeta.Exception.ErrorReadingRepository&quot; ), e );</span>
<span class="fc" id="L648">    }</span>
<span class="fc" id="L649">  }</span>

  public void saveRep( Repository rep, IMetaStore metaStore, ObjectId id_transformation, ObjectId id_step )
    throws KettleException {
    try {

<span class="fc" id="L655">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_INDEX ), getIndex() );</span>
<span class="fc" id="L656">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TYPE ), getType() );</span>

<span class="fc" id="L658">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_BATCH_SIZE ), batchSize );</span>
<span class="fc" id="L659">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TIMEOUT ), getTimeOut() );</span>
<span class="fc" id="L660">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_TIMEOUT_UNIT ),</span>
<span class="fc" id="L661">          getTimeoutUnit().toString() );</span>

<span class="fc" id="L663">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_IS_JSON ),</span>
<span class="fc" id="L664">          isJsonInsert() );</span>
<span class="fc" id="L665">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_JSON_FIELD ),</span>
<span class="fc" id="L666">          getJsonField() );</span>

<span class="fc" id="L668">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_ID_IN_FIELD ),</span>
<span class="fc" id="L669">          getIdInField() );</span>
<span class="fc" id="L670">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_OVERWRITE_IF_EXISTS ),</span>
<span class="fc" id="L671">          isOverWriteIfSameId() );</span>

<span class="fc" id="L673">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_ID_OUT_FIELD ),</span>
<span class="fc" id="L674">          getIdOutField() );</span>

<span class="fc" id="L676">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_USE_OUTPUT ),</span>
<span class="fc" id="L677">          isUseOutput() );</span>
<span class="fc" id="L678">      rep.saveStepAttribute( id_transformation, id_step, joinRepAttr( Dom.TAG_GENERAL, Dom.TAG_STOP_ON_ERROR ),</span>
<span class="fc" id="L679">          isStopOnError() );</span>

      // Fields
<span class="fc bfc" id="L682" title="All 2 branches covered.">      for ( int i = 0; i &lt; fields.size(); i++ ) {</span>
<span class="fc" id="L683">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_FIELD, Dom.TAG_NAME ), fields.get(</span>
            i ).name );
<span class="fc" id="L685">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_FIELD, Dom.TAG_TARGET ), fields.get(</span>
            i ).targetName );
      }

      // Servers
<span class="fc bfc" id="L690" title="All 2 branches covered.">      for ( int i = 0; i &lt; servers.size(); i++ ) {</span>
<span class="fc" id="L691">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_SERVER, Dom.TAG_SERVER_ADDRESS ),</span>
<span class="fc" id="L692">            servers.get( i ).address );</span>
<span class="fc" id="L693">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_SERVER, Dom.TAG_SERVER_PORT ),</span>
<span class="fc" id="L694">            servers.get( i ).port );</span>
      }

      // Settings
<span class="fc bfc" id="L698" title="All 2 branches covered.">      for ( int i = 0; i &lt; settings.size(); i++ ) {</span>
<span class="fc" id="L699">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_SETTING, Dom.TAG_SETTING_NAME ),</span>
<span class="fc" id="L700">            settings.get( i ).setting );</span>
<span class="fc" id="L701">        rep.saveStepAttribute( id_transformation, id_step, i, joinRepAttr( Dom.TAG_SETTING, Dom.TAG_SETTING_VALUE ),</span>
<span class="fc" id="L702">            settings.get( i ).value );</span>
      }

<span class="nc" id="L705">    } catch ( Exception e ) {</span>
<span class="nc" id="L706">      throw new KettleException( BaseMessages.getString( PKG,</span>
          &quot;ElasticSearchBulkMeta.Exception.ErrorSavingToRepository&quot;, &quot;&quot; + id_step ), e );
<span class="fc" id="L708">    }</span>
<span class="fc" id="L709">  }</span>

  public void check( List&lt;CheckResultInterface&gt; remarks, TransMeta transMeta, StepMeta stepMeta, RowMetaInterface prev,
      String[] input, String[] output, RowMetaInterface info, VariableSpace space, Repository repository,
      IMetaStore metaStore ) {

<span class="nc" id="L715">    checkBasicRequiredFields( remarks, stepMeta );</span>

<span class="nc" id="L717">    checkInputFields( remarks, prev, stepMeta );</span>

<span class="nc" id="L719">  }</span>

  private void checkBasicRequiredFields( List&lt;CheckResultInterface&gt; remarks, StepMeta stepMeta ) {
<span class="nc" id="L722">    checkRequiredString( remarks, stepMeta, getIndex(), BaseMessages.getString( PKG,</span>
        &quot;ElasticSearchBulkDialog.Index.Label&quot; ) );
<span class="nc" id="L724">    checkRequiredString( remarks, stepMeta, getType(), BaseMessages.getString( PKG,</span>
        &quot;ElasticSearchBulkDialog.Type.Label&quot; ) );
<span class="nc" id="L726">    checkRequiredString( remarks, stepMeta, getBatchSize(), BaseMessages.getString( PKG,</span>
        &quot;ElasticSearchBulkDialog.BatchSize.Label&quot; ) );
<span class="nc" id="L728">  }</span>

  private void checkRequiredString( List&lt;CheckResultInterface&gt; remarks, StepMeta stepMeta, String value,
      String fieldName ) {
<span class="nc bnc" id="L732" title="All 2 branches missed.">    if ( StringUtils.isBlank( value ) ) {</span>
<span class="nc" id="L733">      remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,</span>
          &quot;ElasticSearchBulkMeta.CheckResult.MissingRequired&quot;, fieldName ), stepMeta ) );
    } else {
<span class="nc" id="L736">      remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString( PKG,</span>
          &quot;ElasticSearchBulkMeta.CheckResult.RequiredOK&quot;, fieldName, value ), stepMeta ) );
    }
<span class="nc" id="L739">  }</span>

  private void checkInputFields( List&lt;CheckResultInterface&gt; remarks, RowMetaInterface prev, StepMeta stepMeta ) {

<span class="nc bnc" id="L743" title="All 4 branches missed.">    if ( prev != null &amp;&amp; prev.size() &gt; 0 ) {</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">      if ( isJsonInsert() ) { // JSON</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">        if ( StringUtils.isBlank( getJsonField() ) ) { // jsonField not set</span>
<span class="nc" id="L746">          String jsonFieldLabel = BaseMessages.getString( PKG, &quot;ElasticSearchBulkDialog.JsonField.Label&quot; );</span>
<span class="nc" id="L747">          String isJsonLabel = BaseMessages.getString( PKG, &quot;ElasticSearchBulkDialog.IsJson.Label&quot; );</span>
<span class="nc" id="L748">          remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,</span>
              &quot;ElasticSearchBulkMeta.CheckResult.MissingRequiredDependent&quot;, jsonFieldLabel, isJsonLabel ), stepMeta ) );
<span class="nc bnc" id="L750" title="All 2 branches missed.">        } else if ( prev.indexOfValue( getJsonField() ) &lt; 0 ) { // jsonField not in input</span>
<span class="nc" id="L751">          remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,</span>
<span class="nc" id="L752">              &quot;ElasticSearchBulkMeta.CheckResult.MissingInput&quot;, getJsonField() ), stepMeta ) );</span>
        }
      } else { // not JSON
<span class="nc bnc" id="L755" title="All 2 branches missed.">        for ( Field f : fields ) {</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">          if ( prev.indexOfValue( f.name ) &lt; 0 ) { // fields not found</span>
<span class="nc" id="L757">            remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,</span>
                &quot;ElasticSearchBulkMeta.CheckResult.MissingInput&quot;, f.name ), stepMeta ) );
          }
<span class="nc" id="L760">        }</span>
      }
    } else { // no input
<span class="nc" id="L763">      remarks.add( new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,</span>
          &quot;ElasticSearchBulkMeta.CheckResult.NoInput&quot; ), stepMeta ) );
    }

<span class="nc" id="L767">  }</span>

  public StepInterface getStep( StepMeta stepMeta, StepDataInterface stepDataInterface, int cnr, TransMeta transMeta,
      Trans trans ) {
<span class="nc" id="L771">    return new ElasticSearchBulk( stepMeta, stepDataInterface, cnr, transMeta, trans );</span>
  }

  public StepDataInterface getStepData() {
<span class="fc" id="L775">    return new ElasticSearchBulkData();</span>
  }

  public boolean supportsErrorHandling() {
<span class="fc" id="L779">    return true;</span>
  }

<span class="fc" id="L782">  public static class Server {</span>
    @Injection( name = &quot;ADDRESS&quot; )
    public String address;
    @Injection( name = &quot;PORT&quot; )
    public int port;

    public InetSocketAddress getAddr() {
<span class="nc" id="L789">      return new InetSocketAddress(address, port);</span>
    }
  }

<span class="fc" id="L793">  public static class Field {</span>
    @Injection( name = &quot;NAME&quot; )
    public String name;
    @Injection( name = &quot;TARGET_NAME&quot; )
    public String targetName;
  }

<span class="fc" id="L800">  public static class Setting {</span>
    @Injection( name = &quot;NAME&quot; )
    public String setting;
    @Injection( name = &quot;VALUE&quot; )
    public String value;
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>